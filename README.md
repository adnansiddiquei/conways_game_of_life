# C2: Research Computing (CW Assignment) - Conway's Game of Life
## Table of Contents
1. [Run](#run)
2. [Tests](#tests)
4. [Performance Testing](#pt)
4. [Documentation](#docs)
5. [Report](#report)

## <a name="run"></a> 1. Run the code
Clone the repository and then run
```bash
make all
```
in your terminal, within the root of this repo. This will build the C++ targets and place them into the `bin/` folder.

### <a name="run"></a> 1.1. Run locally
This section explains how to run the simulation on your laptop.

The below two examples are valid examples that can be run now.
```bash
# this will run a 81x81 simulation across 5 ranks, with row decomposition, over 312 generations on the input file provided.
mpirun -np 5 bin/main --input ./tests/test_grid_glider.txt --output ./bin/out1.txt --grid-size 81 --generations 312
```
```bash
# this will randomly generate a 150x150 grid, scatter to 6 ranks and run for 500 generations.
mpirun -np 6 bin/main --output ./bin/out2.txt --grid-size 150 --probability 0.7 --random-seed 21 --generations 500
```
Full usage documenation below:
```bash
# Usage:
#  $ mpirun -np [num_ranks] ./bin/main --file [arg] --grid-size [arg] --generations [arg]
#  $ mpirun -np [num_ranks] ./bin/main --grid-size [arg] --generations [arg] --probability [arg] [--random--seed [arg]]
#
# * --generations: (int) required. The number of generations to evolve the grid for.
# * --grid-size: (int) required. The dimensions for each square side of the entire 
#                 simulation. This must be provided in even though the grid-size
#                 can technically be inferred from the file.
# * --output: (string) required. File path to save output to.

# * --input: (string) required if --probability is not passed in. This is the file 
#           path to a .txt file containing the initial state.
# * --probability: (float, [0, 1)) required if --file is not passed in. This is 
#                 the probability of a cell being alive in the initial state when 
#                 the initial state is randomly generated.
# * --random-seed: (string) optional. Can be passed in with --probability to 
#                 make the simulation reproducible.
```

If providing an input file with `--input`, the file must be in a format identical to [`src/tests/test_grid_glider.txt`](src/tests/test_grid_glider.txt).
The file must be a square grid (N lines, and N characters per line), with no delimiters. A `1` represents a living cell and a `0`
represents a dead cell. The `--grid-size` parameter must also be provided and it must match exactly with
the number of lines and characters per line in the input file.

### <a name="run"></a> 1.2. Run on the HPC
1. SSH into the HPC
2. Clone the repo
3. Run `nice -19 make all` to build the code.

There are already 3 slurm submit scripts in the `slurm/` folder. 

[`scripts/slurm_submit_1.peta4-icelake`](./scripts/slurm_submit_1.peta4-icelake) will submit a job to run [`scripts/profiler_script_icelake_1.sh`](./scripts/profiler_script_icelake_1.sh) which will reproduce the results for
Figure 5 in the report. [`scripts/slurm_submit_2.peta4-icelake`](./scripts/slurm_submit_2.peta4-icelake)
will reproduce the results for Figure 6 in the report.

For the sake of the user, there is a third slurm script, [`scripts/slurm_submit_runner.peta4icelake`](./scripts/slurm_submit_runner.peta4icelake)
which will submit a job to run [`scripts/runner.sh`](./scripts/runner.sh). Populate the [`scripts/runner.sh`](./scripts/runner.sh) script with the desired
tests or simulations you would like to run on the HPC (a template has been laid out) and submit slurm script. The slurm script has already been populated with
the optimal parameters for the HPC (4 ranks and 19 OMP threads per rank) as concluded in the report.

When submitting the scripts, ensure to submit the scripts from the root of the repo:
```bash
sbatch scripts/slurm_submit_runner.peta4-icelake
```

## <a name="tests"></a> 2. Tests
After running `make all` you can run `make test` and this will run the entire testing GoogleTest testing suite within the `tests/` folder.

## <a name="pt"></a> 3. Performance Testing
The `bin/` folder also contains some executables beginning with `bin/optims_...`.

These executables are derived from the code in the `src/optims/` folder and generate the results for Figures 2 and 3 in the report.
These can be run by directly with
```bash
./bin/optims_convolutions
```
and will output a csv to the `src/plotting/` folder.

This folder is also where you will find a `plots.ipynb` which has the source code for all the plots used in the report.

## <a name="docs"></a> 4. Documentation
The documentation is generated by doxygen, run:
```bash
make docs
```
And then open `docs/html/index.html` in your browser.


## <a name="report"></a> 4. Report
The report is located at [report/out/main.pdf](report/out/main.pdf).
